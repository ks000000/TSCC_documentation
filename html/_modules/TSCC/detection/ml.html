

<!DOCTYPE html>


<html lang="en" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TSCC.detection.ml &#8212; TSCC 0.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="../../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/TSCC/detection/ml';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="Sep 22, 2024"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">TSCC 0.1 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../getting_started.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../usage.html">
                        Usage
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../api_reference.html">
                        API-Reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/TSCC/" title="TSCC" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class=" fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">TSCC</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../getting_started.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../usage.html">
                        Usage
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../api_reference.html">
                        API-Reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/TSCC/" title="TSCC" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class=" fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">TSCC</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">TSCC.detection.ml</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for TSCC.detection.ml</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">IsolationForest</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">OneClassSVM</span>
<span class="kn">from</span> <span class="nn">sklearn.covariance</span> <span class="kn">import</span> <span class="n">EllipticEnvelope</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">LocalOutlierFactor</span>
<span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">import</span> <span class="nn">joblib</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The following functions use a simple dataframe, so you can understand what</span>
<span class="sd">the variables may look like in your own project. But we create immediately two dataframes,</span>
<span class="sd">because some functions need an extra time index.</span>

<span class="sd">First dataframe</span>
<span class="sd">---------------</span>

<span class="sd">&gt;&gt;&gt; d = {&#39;col1&#39;: [1, 9, 3, 6, 20, 8, 3, 1, 30, 5]}</span>
<span class="sd">&gt;&gt;&gt; df = pd.DataFrame(data=d)</span>
<span class="sd">	col1</span>
<span class="sd">0	1</span>
<span class="sd">1	9</span>
<span class="sd">2	3</span>
<span class="sd">3	6</span>
<span class="sd">4	20</span>
<span class="sd">5	8</span>
<span class="sd">6	3</span>
<span class="sd">7	1</span>
<span class="sd">8	30</span>
<span class="sd">9	5</span>

<span class="sd">Second dataframe</span>
<span class="sd">----------------</span>

<span class="sd">&gt;&gt;&gt; dates = np.arange(&#39;2021-07-24 00:00:00&#39;, &#39;2021-07-24 10:00:00&#39;, dtype=&#39;datetime64[h]&#39;)</span>
<span class="sd">&gt;&gt;&gt; d = {&#39;col1&#39;: [1, 9, 3, 6, 20, 8, 3, 1, 30, 5]}</span>
<span class="sd">&gt;&gt;&gt; df_time = pd.DataFrame(data=d, index=dates)</span>
<span class="sd">	                col1</span>
<span class="sd">2021-07-24 00:00:00	1</span>
<span class="sd">2021-07-24 01:00:00	9</span>
<span class="sd">2021-07-24 02:00:00	3</span>
<span class="sd">2021-07-24 03:00:00	6</span>
<span class="sd">2021-07-24 04:00:00	20</span>
<span class="sd">2021-07-24 05:00:00	8</span>
<span class="sd">2021-07-24 06:00:00	3</span>
<span class="sd">2021-07-24 07:00:00	1</span>
<span class="sd">2021-07-24 08:00:00	30</span>
<span class="sd">2021-07-24 09:00:00	5</span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ML_byOneClassSVM"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byOneClassSVM">[docs]</a><span class="k">class</span> <span class="nc">ML_byOneClassSVM</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class that encapsulates the functionality of a OneClassSVM model for anomaly detection and provides methods for</span>
<span class="sd">    reducing training samples, fitting the model, and making predictions.</span>

<span class="sd">    The class is designed to handle large datasets and includes functionality for reducing the number of training</span>
<span class="sd">    samples by undersampling based on conditions such as sensor type and the distribution of target values.</span>
<span class="sd">    It uses a OneClassSVM model to detect anomalies in time series data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    threshold_nrObs : int, default=10000</span>
<span class="sd">        The maximum number of observations to be used for training. If the dataset exceeds this threshold, undersampling or random sampling is applied.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    model : OneClassSVM</span>
<span class="sd">        The OneClassSVM model used for anomaly detection.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    reduce_training_samples(df_fea, gt_series_num, config)</span>
<span class="sd">        Reduces the number of training samples based on ground truth values, sensor type, and predefined thresholds.</span>
<span class="sd">    fit(df_fea, df_tar, config)</span>
<span class="sd">        Fits the OneClassSVM model to the input features.</span>
<span class="sd">    predict(df_fea)</span>
<span class="sd">        Predicts whether each observation in the input dataframe is an anomaly.</span>
<span class="sd">    save_model(path)</span>
<span class="sd">        Saves the trained OneClassSVM model to a specified path.</span>
<span class="sd">    load_model(path)</span>
<span class="sd">        Loads a previously saved OneClassSVM model from a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ML_byOneClassSVM.__init__"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byOneClassSVM.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold_nrObs</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the ML_byOneClassSVM class with a default threshold for the number of observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold_nrObs</span> <span class="o">=</span> <span class="n">threshold_nrObs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">OneClassSVM</span><span class="p">(</span><span class="n">gamma</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ML_byOneClassSVM.reduce_training_samples"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byOneClassSVM.reduce_training_samples">[docs]</a>    <span class="k">def</span> <span class="nf">reduce_training_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_fea</span><span class="p">,</span> <span class="n">gt_series_num</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reduces the number of training samples in the dataframe based on specific conditions and performs undersampling.</span>

<span class="sd">        This function performs undersampling on the input dataframe based on the target values (`gt_series_num`) and sensor type</span>
<span class="sd">        specified in the `config`. The function supports precipitation-type data by undersampling within specified ranges of</span>
<span class="sd">        ground truth values and target detection. The number of samples is reduced to match a predefined threshold.</span>

<span class="sd">        If the size of the filtered dataframe still exceeds the threshold, the function reduces it further by random sampling</span>
<span class="sd">        or concatenating a small subset of the original dataframe.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df_fea : pandas DataFrame</span>
<span class="sd">            The input features for training.</span>
<span class="sd">        gt_series_num : pandas Series or ndarray</span>
<span class="sd">            The target ground truth values (used for filtering).</span>
<span class="sd">        config : object</span>
<span class="sd">            Configuration object that includes sensor type and column names.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        df_filtered : pandas DataFrame</span>
<span class="sd">            The dataframe with reduced samples, after applying undersampling based on conditions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df_fea</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df_filtered</span><span class="p">[</span><span class="s2">&quot;gt_series_num&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gt_series_num</span>

        <span class="n">target_corr_isNumerical</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s2">&quot;gt_series_num&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">target_corr_isNumerical</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_filtered</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold_nrObs</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">config</span><span class="o">.</span><span class="n">sensortype</span> <span class="o">==</span> <span class="s2">&quot;precipitation&quot;</span><span class="p">):</span>
            <span class="n">df_filtered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">undersampling_valrange</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s2">&quot;gt_series_num&quot;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                                      <span class="n">inclusive_range</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
            <span class="n">df_filtered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">undersampling_valrange</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;gt_series_num&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">],</span>
                                                      <span class="n">inclusive_range</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
            <span class="n">df_filtered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">undersampling_valrange</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;gt_series_num&quot;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">777</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                                      <span class="n">inclusive_range</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold_nrObs</span><span class="p">:</span>
            <span class="n">df_filtered</span><span class="p">[</span><span class="n">config</span><span class="o">.</span><span class="n">colname_target_det</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="p">[</span><span class="n">config</span><span class="o">.</span><span class="n">colname_target_det</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">df_filtered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">undersampling_valrange</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">colname_target_det</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.99</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                                      <span class="n">inclusive_range</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
            <span class="n">df_filtered</span><span class="p">[</span><span class="n">config</span><span class="o">.</span><span class="n">colname_target_det</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="p">[</span><span class="n">config</span><span class="o">.</span><span class="n">colname_target_det</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold_nrObs</span><span class="p">:</span>
            <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold_nrObs</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold_nrObs</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_filtered</span><span class="p">,</span> <span class="n">df_fea</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold_nrObs</span> <span class="o">/</span> <span class="mi">100</span><span class="p">))])</span>
        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gt_series_num&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">df_filtered</span></div>

<div class="viewcode-block" id="ML_byOneClassSVM.fit"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byOneClassSVM.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_fea</span><span class="p">,</span> <span class="n">df_tar</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">config</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits the OneClassSVM model to the provided dataframe.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df_fea : pandas dataframe</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_fea</span><span class="p">)</span></div>

<div class="viewcode-block" id="ML_byOneClassSVM.predict"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byOneClassSVM.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_fea</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predict values based on the OneClassSVM model to the provided dataframe.</span>
<span class="sd">        Function does not support NaN values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df : pandas dataframe</span>
<span class="sd">        oneClass_SVM : OneClassSVM object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hasGoodDQ : pandas series</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">noOutlier</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_fea</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df_fea</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="c1">#hasGoodDQ = [False if cur_val == -1 else True for cur_val in noOutlier]</span>
        <span class="n">isError</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">cur_val</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">cur_val</span> <span class="ow">in</span> <span class="n">noOutlier</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">isError</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df_fea</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;isError&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span></div>

<div class="viewcode-block" id="ML_byOneClassSVM.save_model"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byOneClassSVM.save_model">[docs]</a>    <span class="k">def</span> <span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the model to a file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">          The path to save the model file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="ML_byOneClassSVM.load_model"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byOneClassSVM.load_model">[docs]</a>    <span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the model from a file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">          The path to the model file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ML_byIsolationForest"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byIsolationForest">[docs]</a><span class="k">class</span> <span class="nc">ML_byIsolationForest</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class that encapsulates the functionality of an Isolation Forest model for detecting anomalies and provides</span>
<span class="sd">    methods for fitting the model, predicting outliers, and saving/loading the trained model.</span>

<span class="sd">    The class is designed for unsupervised anomaly detection in time series or tabular data and leverages the</span>
<span class="sd">    Isolation Forest algorithm, which isolates anomalies by partitioning data points in a random forest structure.</span>
<span class="sd">    It supports configurations for model parameters like the number of estimators and contamination rate.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_estimators : int, default=100</span>
<span class="sd">        The number of base estimators (trees) in the Isolation Forest ensemble.</span>
<span class="sd">    max_samples : int, float, or &#39;auto&#39;, default=&#39;auto&#39;</span>
<span class="sd">        The number of samples to draw from the input data to train each base estimator.</span>
<span class="sd">    contamination : &#39;auto&#39; or float, default=&#39;auto&#39;</span>
<span class="sd">        The proportion of outliers in the dataset. If &#39;auto&#39;, the contamination is inferred.</span>
<span class="sd">    random_state : int, RandomState instance, or None, default=None</span>
<span class="sd">        Controls the randomness of the algorithm for reproducibility.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    model : IsolationForest</span>
<span class="sd">        The underlying Isolation Forest model used for anomaly detection.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    fit(df_fea, df_tar, config)</span>
<span class="sd">        Fits the Isolation Forest model to the provided feature data.</span>
<span class="sd">    predict(df_fea)</span>
<span class="sd">        Predicts whether each observation in the input dataframe is an anomaly.</span>
<span class="sd">    save_model(path)</span>
<span class="sd">        Saves the trained Isolation Forest model to a specified file path.</span>
<span class="sd">    load_model(path)</span>
<span class="sd">        Loads a previously saved Isolation Forest model from a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ML_byIsolationForest.__init__"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byIsolationForest.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">contamination</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the IsolationForest model.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">IsolationForest</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">=</span><span class="n">max_samples</span><span class="p">,</span>
                                     <span class="n">contamination</span><span class="o">=</span><span class="n">contamination</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span></div>

<div class="viewcode-block" id="ML_byIsolationForest.fit"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byIsolationForest.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_fea</span><span class="p">,</span> <span class="n">df_tar</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">config</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits the Isolation Forest model to the input feature data.</span>

<span class="sd">        This method trains the Isolation Forest model on the provided dataset, identifying patterns in the normal data points and learning how to detect anomalies. It requires that the input data contains no NaN values, as the model cannot handle missing data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df_fea : pandas DataFrame or pandas Series</span>
<span class="sd">            The feature data on which to train the model. This data should not contain any missing values (NaN).</span>
<span class="sd">        df_tar : pandas DataFrame or pandas Series, optional</span>
<span class="sd">            The target data (if any) is not used in unsupervised anomaly detection but can be passed for consistency in the API. Default is None.</span>
<span class="sd">        config : object, optional</span>
<span class="sd">            Configuration object (if any) is not used in unsupervised anomaly detection but can be passed for consistency in the API. Default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            This method fits the Isolation Forest model and updates the model&#39;s internal state.</span>

<span class="sd">       &quot;&quot;&quot;</span>
        <span class="n">ser_df</span> <span class="o">=</span> <span class="n">df_fea</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ser_df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">my_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ser_df</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ser_df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
            <span class="n">my_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ser_df</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">my_array</span><span class="p">)</span></div>

<div class="viewcode-block" id="ML_byIsolationForest.predict"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byIsolationForest.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_fea</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predict values based on the Isolation Forest model to the provided dataframe.</span>
<span class="sd">        Function does not support NaN values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df_fea : pandas dataframe or pandas series</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hasGoodDQ : pandas series</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ser_df</span> <span class="o">=</span> <span class="n">df_fea</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ser_df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">my_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ser_df</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ser_df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
            <span class="n">my_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ser_df</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">noOutlier</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">my_array</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">ser_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="c1">#hasGoodDQ = [False if cur_val == -1 else True for cur_val in noOutlier]</span>
        <span class="n">isError</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">cur_val</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">cur_val</span> <span class="ow">in</span> <span class="n">noOutlier</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">isError</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">ser_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;isError&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span></div>

<div class="viewcode-block" id="ML_byIsolationForest.save_model"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byIsolationForest.save_model">[docs]</a>    <span class="k">def</span> <span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the model to a file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">          The path to save the model file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="ML_byIsolationForest.load_model"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byIsolationForest.load_model">[docs]</a>    <span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the model from a file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">          The path to the model file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="ML_byMLP"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byMLP">[docs]</a><span class="k">class</span> <span class="nc">ML_byMLP</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for building and using a Multi-Layer Perceptron (MLP) classifier for supervised machine learning tasks.</span>

<span class="sd">    This class utilizes the `MLPClassifier` from the scikit-learn library to model data using a feedforward neural network.</span>
<span class="sd">    The architecture of the network, including the number of hidden layers and the activation function, can be customized through the constructor parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    hidden_layer_sizes : tuple, optional, default=(100,)</span>
<span class="sd">        Defines the number of neurons in each hidden layer. The length of the tuple indicates the number of hidden layers.</span>
<span class="sd">    activation : {&#39;identity&#39;, &#39;logistic&#39;, &#39;tanh&#39;, &#39;relu&#39;}, optional, default=&#39;relu&#39;</span>
<span class="sd">        The activation function for the hidden layer.</span>
<span class="sd">    solver : {&#39;lbfgs&#39;, &#39;sgd&#39;, &#39;adam&#39;}, optional, default=&#39;adam&#39;</span>
<span class="sd">        The algorithm used for weight optimization.</span>
<span class="sd">    alpha : float, optional, default=0.0001</span>
<span class="sd">        L2 regularization term to prevent overfitting.</span>
<span class="sd">    batch_size : int or &#39;auto&#39;, optional, default=&#39;auto&#39;</span>
<span class="sd">        The size of minibatches for stochastic optimizers.</span>
<span class="sd">    learning_rate : {&#39;constant&#39;, &#39;invscaling&#39;, &#39;adaptive&#39;}, optional, default=&#39;constant&#39;</span>
<span class="sd">        The learning rate schedule for weight updates.</span>
<span class="sd">    learning_rate_init : float, optional, default=0.001</span>
<span class="sd">        The initial learning rate.</span>
<span class="sd">    max_iter : int, optional, default=200</span>
<span class="sd">        The maximum number of iterations for training.</span>
<span class="sd">    random_state : int, RandomState instance or None, optional, default=None</span>
<span class="sd">        Controls the random seed for reproducibility.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    fit(df_fea, df_tar, config):</span>
<span class="sd">        Trains the MLP model on the provided feature data and target labels.</span>
<span class="sd">    predict(df_fea):</span>
<span class="sd">        Predicts class labels for new input samples based on the trained model.</span>
<span class="sd">    save_model(path):</span>
<span class="sd">        Saves the trained model to a specified file path.</span>
<span class="sd">    load_model(path):</span>
<span class="sd">        Loads a trained model from a specified file path.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ML_byMLP.__init__"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byMLP.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hidden_layer_sizes</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,),</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
                 <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span>
                 <span class="n">learning_rate_init</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the MLPClassifier model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">MLPClassifier</span><span class="p">(</span><span class="n">hidden_layer_sizes</span><span class="o">=</span><span class="n">hidden_layer_sizes</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
                                   <span class="n">solver</span><span class="o">=</span><span class="n">solver</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
                                   <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">,</span> <span class="n">learning_rate_init</span><span class="o">=</span><span class="n">learning_rate_init</span><span class="p">,</span>
                                   <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span></div>

<div class="viewcode-block" id="ML_byMLP.fit"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byMLP.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_fea</span><span class="p">,</span> <span class="n">df_tar</span><span class="p">,</span> <span class="n">config</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trains the Multi-Layer Perceptron (MLP) classifier using the provided feature data and target labels.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df_fea : pandas DataFrame</span>
<span class="sd">            The input feature data used for training the model, where each row represents a sample and each column represents a feature.</span>
<span class="sd">        df_tar : pandas Series or array-like</span>
<span class="sd">            The target labels corresponding to the input feature data. Each value indicates the class label for the respective sample.</span>
<span class="sd">        config : object, optional</span>
<span class="sd">            Configuration object for any additional settings (not currently used in this method).</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">train_array</span> <span class="o">=</span> <span class="n">df_fea</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_array</span><span class="p">,</span> <span class="n">df_tar</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span><span class="c1">#squeeze</span></div>


<div class="viewcode-block" id="ML_byMLP.predict"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byMLP.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_fea</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predicts class labels for the given input feature data using the trained MLP classifier.</span>

<span class="sd">        This method uses the fitted MLP model in a class instance to generate predictions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df_fea : pandas DataFrame</span>
<span class="sd">            The input feature data for which predictions are to be made. Each row should represent a sample, and each column should represent a feature.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas Series</span>
<span class="sd">            A Series containing the predicted class labels for each input sample. The values are cast to float for compatibility with other numerical operations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">my_array</span> <span class="o">=</span> <span class="n">df_fea</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">my_array</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df_fea</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span></div>

<div class="viewcode-block" id="ML_byMLP.save_model"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byMLP.save_model">[docs]</a>    <span class="k">def</span> <span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the model to a file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">          The path to save the model file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="ML_byMLP.load_model"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byMLP.load_model">[docs]</a>    <span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the model from a file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">          The path to the model file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ML_byRF"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byRF">[docs]</a><span class="k">class</span> <span class="nc">ML_byRF</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   A class for implementing a Random Forest Classifier for classification tasks.</span>

<span class="sd">   This class utilizes the `RandomForestClassifier` from the scikit-learn library to model the relationship</span>
<span class="sd">   between input features and target class labels. It provides methods for training the model, making predictions,</span>
<span class="sd">   and saving/loading the model.</span>

<span class="sd">   Parameters</span>
<span class="sd">   ----------</span>
<span class="sd">   n_estimators: int, optional, default=100</span>
<span class="sd">       The number of trees in the forest. A higher number can improve performance but increases computation time.</span>

<span class="sd">   random_state: int, RandomState instance or None, optional, default=None</span>
<span class="sd">       Controls the randomness of the estimator for reproducibility.</span>

<span class="sd">   Methods</span>
<span class="sd">   -------</span>
<span class="sd">   fit(df_fea, df_tar, config):</span>
<span class="sd">       Fits the RandomForestClassifier model to the training data.</span>

<span class="sd">   predict(df_fea):</span>
<span class="sd">       Predicts class labels for the given input feature data.</span>

<span class="sd">   save_model(path):</span>
<span class="sd">       Saves the trained model to a specified file path.</span>

<span class="sd">   load_model(path):</span>
<span class="sd">       Loads a previously saved model from a specified file path.</span>
<span class="sd">   &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ML_byRF.__init__"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byRF.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the ML_byRF class with a RandomForestClassifier model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span></div>

<div class="viewcode-block" id="ML_byRF.fit"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byRF.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_fea</span><span class="p">,</span> <span class="n">df_tar</span><span class="p">,</span> <span class="n">config</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trains the RandomForestClassifier model using the provided feature and target data.</span>

<span class="sd">        This method fits the Random Forest model to the training dataset, enabling it to learn the relationship</span>
<span class="sd">        between the input features and their corresponding target class labels. Note that the function does not</span>
<span class="sd">        handle NaN values, so the input data must be preprocessed to ensure it is free of missing values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df_fea: pandas DataFrame</span>
<span class="sd">            A DataFrame containing the input features for training. Each column represents a feature, and each row</span>
<span class="sd">            represents a training sample.</span>

<span class="sd">        df_tar: pandas DataFrame or Series</span>
<span class="sd">            The target values (class labels) corresponding to the input features. This should be a one-dimensional</span>
<span class="sd">            array-like structure where each entry matches the class label for the respective training sample in `df_fea`.</span>

<span class="sd">        config: optional</span>
<span class="sd">            A configuration object that can be used to specify additional parameters for model fitting, although it</span>
<span class="sd">            is not utilized in this method.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            The fitted model is stored within the instance, allowing for subsequent predictions.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_fea</span><span class="p">,</span> <span class="n">df_tar</span><span class="p">)</span></div>

<div class="viewcode-block" id="ML_byRF.predict"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byRF.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_fea</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predicts the class labels for the given input samples using the trained RandomForestClassifier model.</span>

<span class="sd">        This method takes a DataFrame of input features and uses the fitted model to generate predictions for each</span>
<span class="sd">        sample. The predictions indicate whether each sample is classified as an outlier or not. The method does not</span>
<span class="sd">        support NaN values, so ensure that the input data is clean before calling this function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df_fea: pandas DataFrame</span>
<span class="sd">            A DataFrame containing the input features for which predictions are to be made. Each column represents a</span>
<span class="sd">            feature, and each row corresponds to a sample.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas Series</span>
<span class="sd">            A Series containing the predicted class labels for each input sample, with the same index as</span>
<span class="sd">            the input DataFrame. The values are converted to floats for consistency.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">isError</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_fea</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df_fea</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">isError</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span></div>

<div class="viewcode-block" id="ML_byRF.save_model"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byRF.save_model">[docs]</a>    <span class="k">def</span> <span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the model to a file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">          The path to save the model file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="ML_byRF.load_model"><a class="viewcode-back" href="../../../det_ml.html#TSCC.detection.ml.ML_byRF.load_model">[docs]</a>    <span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the model from a file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">          The path to the model file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div></div>


</pre></div>

                </article>
              
              
              
              
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2023, default.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>